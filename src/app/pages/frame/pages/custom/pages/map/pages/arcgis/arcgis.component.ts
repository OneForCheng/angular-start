import { Component, OnInit } from '@angular/core';
import { EssenceNg2EsriMapComponent } from 'essence-ng2-esrimap';
import { environment } from '../../../../../../../../../environments/environment';

declare let simplify: any;

@Component({
	templateUrl: './arcgis.component.html',
	styleUrls: ['./arcgis.component.scss']
})
export class ArcGISComponent implements OnInit {
	esriMap: EssenceNg2EsriMapComponent;
	map: any;
	initExtent: any;
	isProxy: boolean = false;
	proxy: string = environment.proxy;
	pathArr: any[] = [[116.300055, 40.046678], [116.300063, 40.046672], [116.300135, 40.046728], [116.300166, 40.04674], [116.300172, 40.046744], [116.300224, 40.046748], [116.300266, 40.04676], [116.300284, 40.046817], [116.300389, 40.0468], [116.300451, 40.046849], [116.300537, 40.046843], [116.300598, 40.046842], [116.30063, 40.046848], [116.300677, 40.046865], [116.300717, 40.046856], [116.300753, 40.046862], [116.300768, 40.046863], [116.300765, 40.046862], [116.300766, 40.046863], [116.300772, 40.046867], [116.300785, 40.046875], [116.300806, 40.046892], [116.300822, 40.046904], [116.300833, 40.046915], [116.300831, 40.046918], [116.300839, 40.04692], [116.300855, 40.04693], [116.300869, 40.046941], [116.30088, 40.046941], [116.300896, 40.046945], [116.300908, 40.046951], [116.300925, 40.046955], [116.300943, 40.046961], [116.30096, 40.046968], [116.300975, 40.046969], [116.30099, 40.046969], [116.300999, 40.04697], [116.301012, 40.046968], [116.301019, 40.046971], [116.301031, 40.046973], [116.301039, 40.046976], [116.301048, 40.046982], [116.301068, 40.046995], [116.301084, 40.047007], [116.301086, 40.047014], [116.301089, 40.047021], [116.30109, 40.047032], [116.301094, 40.047044], [116.301093, 40.047051], [116.301097, 40.047055], [116.301097, 40.047058], [116.3011, 40.047062], [116.301102, 40.04707], [116.301099, 40.047078], [116.301094, 40.047081], [116.301089, 40.047086], [116.301091, 40.047087], [116.301083, 40.047092], [116.301078, 40.047095], [116.30107, 40.047097], [116.301063, 40.0471], [116.301059, 40.047104], [116.301049, 40.047109], [116.30105, 40.047115], [116.301052, 40.047118], [116.301052, 40.047119], [116.301087, 40.047116], [116.301108, 40.047118], [116.301128, 40.047124], [116.301148, 40.047135], [116.301162, 40.047147], [116.301172, 40.047157], [116.30118, 40.047165], [116.301198, 40.047168], [116.301233, 40.047158], [116.301254, 40.047158], [116.301263, 40.047168], [116.301261, 40.047183], [116.301253, 40.047194], [116.301246, 40.047205], [116.301236, 40.047218], [116.301227, 40.047233], [116.301217, 40.047249], [116.301199, 40.047268], [116.301185, 40.047287], [116.301173, 40.047304], [116.30116, 40.047328], [116.301153, 40.047344], [116.301143, 40.047364], [116.301132, 40.047381], [116.301112, 40.0474], [116.301098, 40.04742], [116.301095, 40.047426], [116.301093, 40.047444], [116.301093, 40.047464], [116.301084, 40.047486], [116.301077, 40.0475], [116.301071, 40.04751], [116.301066, 40.047522], [116.30106, 40.047541], [116.301055, 40.047558], [116.301048, 40.047575], [116.301042, 40.047588], [116.301032, 40.0476], [116.301022, 40.047611], [116.301012, 40.047627], [116.301003, 40.047645], [116.300995, 40.047658], [116.300986, 40.047668], [116.300969, 40.047682], [116.300969, 40.047688], [116.300967, 40.047688], [116.300959, 40.047704], [116.300948, 40.047719], [116.30094, 40.047732], [116.300933, 40.04774], [116.300927, 40.04775], [116.300927, 40.047758], [116.300918, 40.047776], [116.300915, 40.047786], [116.300907, 40.0478], [116.300896, 40.047826], [116.300893, 40.047837], [116.300885, 40.047854], [116.300879, 40.047867], [116.300869, 40.047878], [116.300863, 40.047894], [116.30086, 40.047904], [116.300853, 40.047919], [116.300852, 40.047919], [116.300848, 40.047922], [116.300836, 40.047937], [116.300826, 40.047946], [116.300817, 40.047958], [116.300809, 40.047972], [116.300804, 40.047982], [116.3008, 40.047993], [116.300795, 40.048013], [116.300787, 40.048032], [116.300782, 40.048041], [116.300775, 40.048061], [116.300774, 40.04807], [116.30077, 40.048092], [116.300766, 40.048104], [116.300759, 40.048122], [116.300755, 40.048136], [116.300752, 40.048151], [116.300747, 40.048162], [116.30074, 40.048182], [116.300734, 40.0482], [116.300728, 40.048211], [116.300726, 40.048222], [116.300722, 40.048238], [116.300715, 40.048248], [116.300707, 40.048264], [116.300701, 40.048278], [116.300698, 40.048284], [116.300693, 40.048298], [116.300691, 40.048311]];
	tolerance: number = 0.00005;
	highQuality: boolean = false;

	constructor() {
		this.isProxy = !!this.proxy;
		this.initExtent = {
			xmax: 172.68611447428455,
			xmin: 32.06111447428455,
			ymax: 70.08480747618302,
			ymin: -5.764801898816984
		};
	}

	ngOnInit() {
	}

	onMapReady($event: EssenceNg2EsriMapComponent) {
		this.esriMap = $event;
		this.map = this.esriMap.map;

		this.esriMap.loadEsriModules(['esri/geometry/Polyline']).then(([Polyline]) => {
			const newPathArr = simplify(this.pathArr, this.tolerance, this.highQuality);
			const line: any = new Polyline(newPathArr);
			const lineSymbol: any = new this.esriMap.SimpleLineSymbol(
				this.esriMap.SimpleLineSymbol.STYLE_SOLID,
				new this.esriMap.Color([255, 0, 0]),
				5
			);
			const lineGra: any = new this.esriMap.Graphic(line, lineSymbol, null);

			const newPathArr2 = simplify(this.pathArr, this.tolerance, !this.highQuality);
			const line2: any = new Polyline(newPathArr2);
			const lineSymbol2: any = new this.esriMap.SimpleLineSymbol(
				this.esriMap.SimpleLineSymbol.STYLE_SOLID,
				new this.esriMap.Color([51, 102, 255]),
				5
			);
			const lineGra2: any = new this.esriMap.Graphic(line2, lineSymbol2, null);

			this.map.graphics.add(lineGra);
			this.map.graphics.add(lineGra2);
			this.map.setExtent(line.getExtent(), true);
		});
	}

	// drawLine() {
	// 	this.esriMap.loadEsriModules(['esri/geometry/Polyline']).then(([Polyline]) => {
	// 		const newPathArr = simplify(this.pathArr, this.tolerance, this.highQuality);
	// 		console.log(newPathArr);
	// 		const line: any = new Polyline(newPathArr);
	// 		const lineSymbol: any = new this.esriMap.SimpleLineSymbol(
	// 			this.esriMap.SimpleLineSymbol.STYLE_SOLID,
	// 			new this.esriMap.Color([51, 102, 255]),
	// 			5
	// 		);
	// 		const lineGra: any = new this.esriMap.Graphic(line, lineSymbol, null);
	// 		this.map.graphics.clear();
	// 		this.map.graphics.add(lineGra);
	// 	});
	// }
}

